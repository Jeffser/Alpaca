using Gtk 4.0;
using Adw 1;

template $AlpacaPreferencesDialog: Adw.PreferencesDialog {
  can-close: true;
  title: _("Preferences");

  Adw.PreferencesPage {
    icon-name: "settings-symbolic";
    title: _("General");

    Adw.PreferencesGroup {
      Adw.SwitchRow background_switch {
        title: _("Run Alpaca In Background");
      }

      Adw.SwitchRow powersaver_warning_switch {
        title: _("Show Power Saver Warning");
        subtitle: _("When running a managed Ollama instance");
      }

      Adw.SpinRow zoom_spin {
        output => $zoom_changed();
        title: _("Zoom");

        adjustment: Adjustment {
          lower: 100;
          upper: 200;
          step-increment: 10;
        };
      }
    }

    Adw.PreferencesGroup {
      Adw.SwitchRow regenerate_after_edit {
        title: _("Regenerate Response After Editing Message");
        subtitle: _("Applicable when the next message was generated by an AI model");
      }

      Adw.SpinRow image_size_spin {
        title: _("Max Image Attachment Size");
        subtitle: _("This might affect the performance of vision models");

        adjustment: Adjustment {
          lower: 240;
          upper: 1080;
          step-increment: 10;
        };
      }
    }

    Adw.PreferencesGroup {
      Adw.ButtonRow delete_all_chats {
        title: _("Delete All Chats");
        activated => $delete_all_chats_button_pressed();
        styles [
          "error",
        ]
      }
    }
  }

  Adw.PreferencesPage audio_page {
    icon-name: "music-note-single-symbolic";
    title: _("Audio");

    Adw.PreferencesGroup mic_group {
      Adw.ComboRow mic_model_combo {
        title: _("Speech Recognition Model");
        subtitle: _("Models are downloaded upon first use, you can delete them from the model manager");
        model: StringList {};
      }

      Adw.ComboRow mic_language_combo {
        title: _("Speech Recognition Language");
        sensitive: false;
        model: StringList {};
      }

      Adw.SwitchRow mic_auto_send_switch {
        title: _("Auto Send Message After Talking");
        sensitive: false;
      }
    }

    Adw.PreferencesGroup tts_group {
      Adw.ComboRow tts_voice_combo {
        title: _("Default Text to Speech Voice");
        subtitle: _("Voices are downloaded upon first use, each weighing around 1 MB, and you can delete them from the model manager");
        model: StringList {};
      }

      Adw.SwitchRow tts_auto_mode_combo {
        title: _("Dictate New Messages Automatically");
        subtitle: _("Dictate new messages as they are generated");
      }

      Adw.SpinRow tts_speed_spin {
        title: _("Dictation Speed");
        subtitle: _("Modify the speed of the dictation voice");
        digits: 1;

        adjustment: Adjustment {
          lower: 0.5;
          upper: 2.0;
          step-increment: 0.1;
        };
      }
    }
  }

  Adw.PreferencesPage activities_page {
    icon-name: "shapes-symbolic";
    title: _("Activities");

    Adw.PreferencesGroup {
      Adw.ComboRow default_tool {
        title: _("Default Tool");
        subtitle: _("Applied when a model is compatible with tools");
        model: StringList {
          strings [
            _("No Tool"),
            _("Auto Detect Tool"),
            _("Web Search"),
            _("Terminal"),
            _("Background Remover"),
          ]
        };
      }

      Adw.ComboRow activity_mode {
        title: _("Preferred Activity Mode");
        subtitle: _("This affects how terminals, attachments and other activities are represented in the main window");

        model: StringList {
          strings [
            _("Sidebar"),
            _("Dialog"),
            _("Window"),
          ]
        };
      }
    }

    Adw.PreferencesGroup activity_web_browser_group {
      title: _("Web Browser");

      Adw.ComboRow activity_web_browser_engine {
        title: _("Search Engine");
        notify::selected => $activity_web_browser_engine_changed();

        model: StringList {
          strings [
            "Startpage",
            "DuckDuckGo",
            "Google",
            _("Custom"),
          ]
        };
      }

      Adw.EntryRow activity_web_browser_query_url {
        title: _("Search Query URL");
      }

      Adw.EntryRow activity_web_browser_homepage_url {
        title: _("Homepage URL");
      }
    }

    Adw.PreferencesGroup activity_terminal_group {
      title: _("Terminal");

      Adw.ComboRow activity_terminal_type {
        title: _("Connection Type");
        subtitle: _("How Alpaca will connect to your device");
        notify::selected => $activity_terminal_type_changed();

        model: StringList {
          strings [
            "Directly",
            "SSH"
          ]
        };
      }

      Adw.EntryRow activity_terminal_ssh_user {
        title: _("Username");
      }

      Adw.EntryRow activity_terminal_ssh_ip {
        title: _("Device IP");
      }

      Adw.ActionRow activity_terminal_flatpak_warning {
        child: Gtk.Label {
          label: _("Alpaca needs an additional permission to use the terminal directly");
          wrap: true;
          justify: center;
          styles [
            "p10",
            "dim-label",
          ]
        };
      }

      Adw.ActionRow activity_terminal_flatpak_warning_command {
        child: Gtk.Label {
          label: "flatpak override com.jeffser.Alpaca --talk-name=org.freedesktop.Flatpak";
          selectable: true;
          wrap: true;
          wrap-mode: char;
          styles [
            "card",
            "view",
            "p10",
            "br0",
          ]
        };
        styles [
          "p0",
        ]
      }
    }

    Adw.PreferencesGroup activity_background_remover_group {
      title: _("Background Remover");
        Adw.ComboRow activity_background_remover_default_model {
          title: _("Default Model");
          model: StringList {};
        }
      }
  }
}
